# 2024/04/23

## 正規化

---

### 正規化の定義

ここでの DB の正規系とは、一言でいうと、データベースで保持するデータの冗長性を排除し、一貫性と効率性を保持するためのデータ形式のこと  
例えば、一つのテーブルに様々な情報(exp: ユーザーのプロファイル情報、決済情報、投稿物の詳細情報など)wp 保持させてしまうと、データの取得・更新時に無駄なデータの取得・更新が必要になってしまう

→ これを**冗長性**と呼ぶ

こうした冗長性があると更新処理のタイムラグによってデータの不整合が発生したり、そもそもデータの登録ができなかったりする**非一貫性**が生まれてしまう

## 第一正規形

第一正規形の定義は「**スカラの原則**」
→ 一つのセルの中には、一つの値しか含まない

### なぜこの原則が必要なのか

1. 主キーが一つに定まらない
2. テーブルの意味やレコードの単位が曖昧になる

## 第二正規形

第一正規化が終わった下記のようなテーブルを考えてみる

| 会社コード | 会社名 | 社員 ID | 社員名 | 年齢 | 部署コード | 部署名 |
| ---------- | ------ | ------- | ------ | ---- | ---------- | ------ |
| C0001      | A 商事 | 000A    | 加藤   | 40   | D01        | 開発   |

このテーブルには{会社コード, 社員 ID}という二つの主キーが存在する。
おそらくこのテーブルは社員情報を保有するテーブルと考えられる。そうなると「会社名」という列は会社コードの一部になるはず

この場合だと、下記のような関数従属性が存在する。
`{会社コード} → {会社名}`

このように**主キーの一部の列に対して従属する列が存在する場合、この関係を部分関数従属**と呼ぶ

第二正規化では、この**部分関数従属をテーブル分割によって排除**すること。

### ではなぜ第二正規形にしないといけないのか

この第二正規形にしないといけない最たる理由は、データの塊を適切なエンティティに持たせることでデータの冗長性を排除し、誤登録の回避すること
今回のテーブル例で考えると、社員情報を登録・更新する際に余計な会社情報まで登録・更新しないで済む → 会社情報は会社情報を保持するテーブルとして個別管理する
